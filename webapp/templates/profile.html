<!-- CRÉDITOS (empilhado, como Perfil) -->
<div class="profile-view" id="view-creditos" style="display:none;">

  <!-- Bloco: Saldo e consumo -->
  <div class="about-card">
    <h2 class="view-title">Créditos</h2>
    <p class="about-text">Saldo atual: <strong>{{ user.credits or 0 }}</strong> tokens</p>
    <p class="about-text">Última recarga: {{ user.last_topup_at.strftime('%d/%m/%Y %H:%M') if user.last_topup_at else '—' }}</p>
  </div>

  <!-- Bloco: Comprar tokens -->
  <div class="about-card" style="margin-top:16px;">
    <h3 class="about-title">Comprar tokens</h3>
    <p class="about-text">Escolha um pacote para continuar modelando sem limites.</p>

    <!-- Packs simples de exemplo -->
    <div class="grid-2" style="gap:12px; margin-top:10px;">
      <button class="btn" id="buy-50"  data-pack="50">+50 tokens</button>
      <button class="btn" id="buy-200" data-pack="200">+200 tokens</button>
    </div>

    <div class="grid-2" style="gap:12px; margin-top:10px;">
      <button class="btn" id="buy-500" data-pack="500">+500 tokens</button>
      <button class="btn" id="buy-1000" data-pack="1000">+1000 tokens</button>
    </div>

    <small class="about-text" style="display:block; margin-top:10px;">
      Pagamentos processados com segurança via Stripe.
    </small>
  </div>

  <!-- Bloco: Histórico (opcional) -->
  <div class="about-card" style="margin-top:16px;">
    <h3 class="about-title">Histórico de créditos</h3>
    {% if topups and topups|length %}
      <ul class="mono" style="margin:0; padding-left:18px;">
        {% for t in topups %}
          <li>{{ t.created_at.strftime('%d/%m/%Y %H:%M') }} — +{{ t.amount }} tokens — {{ t.status }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="about-text">Nenhuma compra registrada ainda.</p>
    {% endif %}
  </div>
</div>

<script>
async function comprarTokens(pack) {
  try {
    const resp = await fetch('{{ url_for("billing.billing_create_checkout") }}', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ pack })
    });
    const data = await resp.json();
    if (data.url) {
      window.location.href = data.url; // redireciona para o checkout
    } else {
      alert(data.error || 'Falha ao iniciar checkout.');
    }
  } catch (e) {
    alert('Erro de rede ao iniciar checkout.');
  }
}
</script>

